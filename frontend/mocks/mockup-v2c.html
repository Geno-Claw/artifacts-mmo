<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artifacts MMO — Molten Core Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    border-radius: 0 !important;
  }

  :root {
    --jet: #0a0a0a;
    --volcanic-red: #5a0a0a;
    --molten-orange: #ff6020;
    --lava-gold: #ffcc20;
    --ash-gray: #c8c0b8;
    --dark-rock: #1a1210;
    --obsidian: #0e0806;
    --blood-red: #8b0000;
    --deep-ember: #3a1005;
    --crack-glow: #ff4400;
    --dim-text: #7a726a;
  }

  html, body {
    width: 100%;
    height: 100%;
    overflow-x: hidden;
  }

  body {
    font-family: 'Press Start 2P', monospace;
    background: var(--jet);
    color: var(--ash-gray);
    image-rendering: pixelated;
    min-height: 100vh;
    position: relative;
  }

  /* Volcanic background gradient — heat rising from below */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 120% 40% at 50% 110%, #3a0a0280 0%, transparent 70%),
      radial-gradient(ellipse 80% 30% at 50% 105%, #5a0a0a40 0%, transparent 60%),
      linear-gradient(to top, #1a060240 0%, transparent 40%),
      var(--jet);
    z-index: 0;
    pointer-events: none;
  }

  /* Ember particle container */
  #ember-container {
    position: fixed;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    overflow: hidden;
  }

  .ember {
    position: absolute;
    bottom: -8px;
    image-rendering: pixelated;
    animation: ember-rise linear infinite;
    opacity: 0;
  }

  @keyframes ember-rise {
    0% {
      opacity: 0;
      transform: translateY(0) translateX(0);
    }
    5% {
      opacity: 0.9;
    }
    50% {
      opacity: 0.7;
    }
    85% {
      opacity: 0.3;
    }
    100% {
      opacity: 0;
      transform: translateY(-100vh) translateX(var(--drift));
    }
  }

  /* Main layout */
  .dashboard {
    position: relative;
    z-index: 2;
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px 16px 40px;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 24px;
    padding: 16px 0 12px;
    position: relative;
  }

  .header h1 {
    font-size: 14px;
    color: var(--lava-gold);
    text-shadow:
      0 0 8px #ff660080,
      0 0 20px #ff440040,
      2px 2px 0 #1a0800;
    letter-spacing: 3px;
    text-transform: uppercase;
  }

  .header .subtitle {
    font-size: 7px;
    color: var(--dim-text);
    margin-top: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  /* Obsidian crack border mixin — using box-shadow segments */
  .obsidian-border {
    border: 3px solid #1c1410;
    box-shadow:
      /* outer dark edge */
      0 0 0 1px #050302,
      /* crack glow segments — top */
      inset 40px -1px 0 -1px #ff440018,
      inset -60px -1px 0 -1px #ff220010,
      /* crack glow segments — left */
      inset -1px 30px 0 -1px #ff440012,
      inset -1px -50px 0 -1px #ff220010,
      /* subtle inner glow */
      inset 0 0 30px #ff440008,
      /* outer ambient */
      0 0 15px #ff220008,
      0 4px 12px #00000060;
  }

  .obsidian-border::before {
    content: '';
    position: absolute;
    inset: -3px;
    z-index: 0;
    pointer-events: none;
    background:
      /* Lava crack lines — horizontal */
      linear-gradient(90deg, transparent 12%, #ff440015 13%, #ff440015 13.5%, transparent 14%,
        transparent 38%, #ff330010 38.5%, #ff330010 39%, transparent 39.5%,
        transparent 62%, #ff440012 62.5%, #ff440012 63%, transparent 63.5%,
        transparent 85%, #ff220010 85.5%, #ff220010 86%, transparent 86.5%),
      /* Lava crack lines — vertical */
      linear-gradient(180deg, transparent 15%, #ff440010 16%, #ff440010 16.5%, transparent 17%,
        transparent 48%, #ff330012 48.5%, #ff330012 49%, transparent 49.5%,
        transparent 78%, #ff440008 78.5%, #ff440008 79%, transparent 79.5%);
  }

  /* Character card */
  .char-card {
    position: relative;
    background:
      linear-gradient(135deg, #12100e 0%, #0e0a08 40%, #140c08 100%);
    margin-bottom: 14px;
    padding: 14px;
    display: grid;
    grid-template-columns: 100px 1fr auto;
    grid-template-rows: auto auto;
    gap: 0 16px;
    min-height: 170px;
    align-items: start;
  }

  /* Portrait area */
  .portrait-area {
    grid-row: 1 / 3;
    grid-column: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }

  .portrait-frame {
    width: 96px;
    height: 96px;
    border: 2px solid #2a1a10;
    box-shadow:
      inset 0 0 10px #ff440010,
      0 0 6px #ff220008;
    background: #080604;
    position: relative;
    overflow: hidden;
  }

  .portrait-frame canvas {
    width: 96px;
    height: 96px;
    image-rendering: pixelated;
    display: block;
  }

  .char-name {
    font-size: 9px;
    color: var(--lava-gold);
    text-shadow: 1px 1px 0 #1a0800, 0 0 6px #ff660040;
    text-align: center;
    white-space: nowrap;
  }

  .char-level {
    font-size: 7px;
    color: var(--molten-orange);
    text-shadow: 1px 1px 0 #1a0800;
    text-align: center;
  }

  /* Center column — stats */
  .stats-column {
    grid-row: 1 / 3;
    grid-column: 2;
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0;
  }

  /* Log panel (top info) */
  .log-panel {
    background: #0c080618;
    border: 1px solid #2a1a1040;
    padding: 6px 10px;
    min-height: 28px;
    display: flex;
    align-items: center;
  }

  .log-panel .label {
    font-size: 6px;
    color: var(--dim-text);
    margin-right: 8px;
    flex-shrink: 0;
    text-transform: uppercase;
  }

  .log-panel .log-text {
    font-size: 7px;
    color: var(--ash-gray);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Task panel (bottom info) */
  .task-panel {
    background: #0c080618;
    border: 1px solid #2a1a1040;
    padding: 6px 10px;
    min-height: 28px;
    display: flex;
    align-items: center;
  }

  .task-panel .label {
    font-size: 6px;
    color: var(--dim-text);
    margin-right: 8px;
    flex-shrink: 0;
    text-transform: uppercase;
  }

  .task-panel .task-text {
    font-size: 7px;
    color: var(--molten-orange);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Stat bars container */
  .bars-container {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  /* Generic bar row */
  .bar-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .bar-label {
    font-size: 7px;
    width: 22px;
    flex-shrink: 0;
    text-align: right;
    text-transform: uppercase;
  }

  .bar-label.hp { color: #ff4444; text-shadow: 0 0 4px #ff000030; }
  .bar-label.xp { color: var(--molten-orange); text-shadow: 0 0 4px #ff660030; }
  .bar-label.cd { color: var(--lava-gold); text-shadow: 0 0 4px #ffcc2030; }

  .bar-outer {
    flex: 1;
    height: 14px;
    background: #0a0604;
    border: 1px solid #2a1a10;
    position: relative;
    overflow: hidden;
    min-width: 100px;
  }

  .bar-inner {
    height: 100%;
    position: relative;
    transition: width 0.1s linear;
  }

  .bar-inner.hp-bar {
    background: linear-gradient(180deg, #cc0000 0%, #8b0000 50%, #660000 100%);
    box-shadow: 0 0 8px #ff000040, inset 0 1px 0 #ff444440;
  }

  .bar-inner.xp-bar {
    background: linear-gradient(180deg, var(--molten-orange) 0%, #cc4010 50%, #993010 100%);
    box-shadow: 0 0 8px #ff660040, inset 0 1px 0 #ffaa4040;
  }

  .bar-inner.cd-bar {
    background: linear-gradient(180deg, var(--lava-gold) 0%, #cc9910 50%, #997710 100%);
    box-shadow: 0 0 8px #ffcc2040, inset 0 1px 0 #ffee6040;
    animation: lava-shimmer 1.5s ease-in-out infinite;
  }

  @keyframes lava-shimmer {
    0%, 100% {
      filter: brightness(1.0);
    }
    50% {
      filter: brightness(1.3);
    }
  }

  .bar-inner.cd-bar.ready {
    background: linear-gradient(180deg, #44ff44 0%, #22aa22 50%, #118811 100%);
    box-shadow: 0 0 12px #44ff4060;
    animation: ready-flash 0.3s ease-in-out infinite alternate;
  }

  @keyframes ready-flash {
    0% { filter: brightness(1.0); }
    100% { filter: brightness(1.5); }
  }

  .bar-value {
    font-size: 6px;
    width: 90px;
    flex-shrink: 0;
    text-align: right;
    color: var(--ash-gray);
    white-space: nowrap;
  }

  .bar-value.ready-text {
    color: #44ff44;
    text-shadow: 0 0 6px #44ff4060;
    animation: ready-flash 0.3s ease-in-out infinite alternate;
  }

  /* Buttons column */
  .buttons-column {
    grid-row: 1 / 3;
    grid-column: 3;
    display: flex;
    flex-direction: column;
    gap: 4px;
    align-self: center;
  }

  .action-btn {
    width: 52px;
    height: 26px;
    border: 2px solid #2a1a10;
    background: linear-gradient(180deg, #1a1210 0%, #100c08 100%);
    color: var(--dim-text);
    font-family: 'Press Start 2P', monospace;
    font-size: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    transition: all 0.05s;
    box-shadow: inset 0 0 8px #00000040;
  }

  .action-btn:hover {
    background: linear-gradient(180deg, #2a1a10 0%, #1a1008 100%);
    color: var(--molten-orange);
    border-color: #3a2210;
    box-shadow:
      inset 0 0 12px #ff440018,
      0 0 6px #ff440015;
    text-shadow: 0 0 4px #ff660040;
  }

  .action-btn:active {
    background: linear-gradient(180deg, #100c08 0%, #1a1210 100%);
    box-shadow: inset 0 2px 4px #00000060;
  }

  /* Scanline overlay */
  .scanlines {
    position: fixed;
    inset: 0;
    z-index: 100;
    pointer-events: none;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      #00000008 2px,
      #00000008 4px
    );
  }

  /* Vignette */
  .vignette {
    position: fixed;
    inset: 0;
    z-index: 99;
    pointer-events: none;
    background: radial-gradient(ellipse at center, transparent 50%, #0a0a0a80 100%);
  }

  /* Footer */
  .footer {
    text-align: center;
    margin-top: 12px;
    font-size: 6px;
    color: #3a2a20;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* Responsive adjustments */
  @media (max-width: 800px) {
    .char-card {
      grid-template-columns: 80px 1fr auto;
      padding: 10px;
      min-height: 150px;
    }
    .portrait-frame, .portrait-frame canvas {
      width: 72px;
      height: 72px;
    }
    .action-btn {
      width: 44px;
      height: 22px;
      font-size: 4px;
    }
    .bar-value {
      width: 70px;
    }
  }
</style>
</head>
<body>

<div id="ember-container"></div>
<div class="scanlines"></div>
<div class="vignette"></div>

<div class="dashboard">
  <div class="header">
    <h1>Artifacts MMO</h1>
    <div class="subtitle">Molten Core &mdash; Party Dashboard</div>
  </div>

  <div id="card-container"></div>

  <div class="footer">Bot Manager v2.0 &mdash; Volcanic Edition</div>
</div>

<script>
// ============================================================
// MOCK DATA
// ============================================================
const characters = [
  {
    name: 'Artifax', level: 25, hp: 340, maxHp: 450, xp: 12500, maxXp: 18000,
    portraitType: 'warrior', cooldown: 12.0, maxCooldown: 15.0,
    log: ['Fighting Chicken (Lv.3)...', 'Looted Feather x2', 'Resting at campfire...', 'Equipping Iron Shield...'],
    task: 'Kill 50 Chickens (32/50)'
  },
  {
    name: 'Luminos', level: 18, hp: 180, maxHp: 220, xp: 8200, maxXp: 12000,
    portraitType: 'mage', cooldown: 8.0, maxCooldown: 12.0,
    log: ['Crafting Iron Sword...', 'Smelting ore at forge...', 'Bought Coal x5', 'Withdrawing Iron Ore...'],
    task: 'Craft 10 Iron Swords (7/10)'
  },
  {
    name: 'Verdant', level: 22, hp: 260, maxHp: 300, xp: 15600, maxXp: 20000,
    portraitType: 'gatherer', cooldown: 3.0, maxCooldown: 8.0,
    log: ['Gathering Ash Wood...', 'Inventory almost full!', 'Depositing at bank...', 'Walking to ash forest...'],
    task: 'Gather 100 Ash Wood (89/100)'
  },
];

// ============================================================
// PIXEL ART PORTRAITS
// ============================================================
function drawPortrait(canvas, type) {
  const w = 12;
  const h = 14;
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext('2d');
  ctx.imageSmoothingEnabled = false;

  const p = (x, y, color) => {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, 1, 1);
  };

  // Common skin tones (warm palette)
  const skin = '#d4956a';
  const skinShade = '#b87a52';
  const eyeWhite = '#e8e0d8';
  const pupil = '#1a0800';
  const mouth = '#8b4030';
  const outline = '#1a0a00';

  if (type === 'warrior') {
    // Dark iron helmet
    const helmet = '#3a3030';
    const helmetHi = '#5a4a44';
    const helmetDk = '#221a18';
    const visor = '#2a2020';
    const plume = '#cc2200';
    const plumeHi = '#ff4420';

    // Helmet top
    p(4, 0, helmetDk); p(5, 0, helmet); p(6, 0, helmet); p(7, 0, helmetDk);
    // Plume
    p(8, 0, plume); p(9, 0, plumeHi); p(9, 1, plume);
    // Helmet row 1
    p(3, 1, helmetDk); p(4, 1, helmet); p(5, 1, helmetHi); p(6, 1, helmetHi); p(7, 1, helmet); p(8, 1, helmetDk);
    // Helmet row 2
    p(2, 2, helmetDk); p(3, 2, helmet); p(4, 2, helmetHi); p(5, 2, helmet); p(6, 2, helmet); p(7, 2, helmetHi); p(8, 2, helmet); p(9, 2, helmetDk);
    // Helmet brim / visor
    p(2, 3, outline); p(3, 3, visor); p(4, 3, visor); p(5, 3, visor); p(6, 3, visor); p(7, 3, visor); p(8, 3, visor); p(9, 3, outline);
    // Face — eyes through visor slit
    p(2, 4, outline); p(3, 4, visor); p(4, 4, eyeWhite); p(5, 4, pupil); p(6, 4, skin); p(7, 4, eyeWhite); p(8, 4, pupil); p(9, 4, outline);
    // Nose area
    p(3, 5, outline); p(4, 5, skin); p(5, 5, skin); p(6, 5, skinShade); p(7, 5, skin); p(8, 5, skin); p(9, 5, outline);
    // Mouth
    p(3, 6, outline); p(4, 6, skin); p(5, 6, mouth); p(6, 6, mouth); p(7, 6, mouth); p(8, 6, skin); p(9, 6, outline);
    // Chin
    p(4, 7, outline); p(5, 7, skinShade); p(6, 7, skin); p(7, 7, skinShade); p(8, 7, outline);
    // Neck
    p(5, 8, skin); p(6, 8, skinShade); p(7, 8, skin);
    // Armor — shoulders & chest
    const armor = '#4a3a30';
    const armorHi = '#6a5548';
    const armorDk = '#2a1a10';
    p(1, 9, armorDk); p(2, 9, armor); p(3, 9, armorHi); p(4, 9, armor); p(5, 9, armorHi); p(6, 9, armor); p(7, 9, armorHi); p(8, 9, armor); p(9, 9, armorHi); p(10, 9, armorDk);
    p(1, 10, armorDk); p(2, 10, armor); p(3, 10, armor); p(4, 10, armorHi); p(5, 10, armor); p(6, 10, armorDk); p(7, 10, armor); p(8, 10, armorHi); p(9, 10, armor); p(10, 10, armorDk);
    p(1, 11, armorDk); p(2, 11, armorDk); p(3, 11, armor); p(4, 11, armor); p(5, 11, armorHi); p(6, 11, armor); p(7, 11, armorHi); p(8, 11, armor); p(9, 11, armorDk); p(10, 11, armorDk);
    p(2, 12, armorDk); p(3, 12, armorDk); p(4, 12, armor); p(5, 12, armor); p(6, 12, armorDk); p(7, 12, armor); p(8, 12, armor); p(9, 12, armorDk);
    p(3, 13, armorDk); p(4, 13, armorDk); p(5, 13, armor); p(6, 13, armorDk); p(7, 13, armor); p(8, 13, armorDk); p(9, 13, armorDk);

  } else if (type === 'mage') {
    // Flame-colored hat
    const hat = '#cc3300';
    const hatHi = '#ff5520';
    const hatDk = '#881800';
    const hatBrim = '#662200';
    const robe = '#552200';
    const robeHi = '#774420';
    const robeDk = '#331100';
    const glow = '#ffaa20';

    // Hat tip
    p(5, 0, hatDk); p(6, 0, hat);
    // Hat widening
    p(4, 1, hatDk); p(5, 1, hat); p(6, 1, hatHi); p(7, 1, hat);
    p(3, 2, hatDk); p(4, 2, hat); p(5, 2, hatHi); p(6, 2, hat); p(7, 2, hatHi); p(8, 2, hatDk);
    p(3, 3, hatDk); p(4, 3, hatHi); p(5, 3, hat); p(6, 3, hatHi); p(7, 3, hat); p(8, 3, hat); p(9, 3, hatDk);
    // Hat brim
    p(1, 4, hatBrim); p(2, 4, hatBrim); p(3, 4, hatBrim); p(4, 4, hatBrim); p(5, 4, hatBrim); p(6, 4, hatBrim); p(7, 4, hatBrim); p(8, 4, hatBrim); p(9, 4, hatBrim); p(10, 4, hatBrim);
    // Face
    p(3, 5, outline); p(4, 5, skin); p(5, 5, skin); p(6, 5, skin); p(7, 5, skin); p(8, 5, skin); p(9, 5, outline);
    // Eyes
    p(3, 6, outline); p(4, 6, eyeWhite); p(5, 6, pupil); p(6, 6, skin); p(7, 6, eyeWhite); p(8, 6, pupil); p(9, 6, outline);
    // Nose
    p(3, 7, outline); p(4, 7, skin); p(5, 7, skin); p(6, 7, skinShade); p(7, 7, skin); p(8, 7, skin); p(9, 7, outline);
    // Mouth
    p(4, 8, outline); p(5, 8, mouth); p(6, 8, mouth); p(7, 8, mouth); p(8, 8, outline);
    // Chin
    p(5, 9, outline); p(6, 9, skinShade); p(7, 9, outline);
    // Robe
    p(2, 10, robeDk); p(3, 10, robe); p(4, 10, robeHi); p(5, 10, robe); p(6, 10, robe); p(7, 10, robeHi); p(8, 10, robe); p(9, 10, robeDk);
    p(2, 11, robeDk); p(3, 11, robe); p(4, 11, robe); p(5, 11, robeHi); p(6, 11, robeDk); p(7, 11, robeHi); p(8, 11, robe); p(9, 11, robeDk);
    p(2, 12, robeDk); p(3, 12, robeDk); p(4, 12, robe); p(5, 12, robe); p(6, 12, robe); p(7, 12, robe); p(8, 12, robe); p(9, 12, robeDk);
    // Staff glow hint
    p(10, 10, glow); p(10, 11, hatHi); p(10, 12, hatDk);
    p(3, 13, robeDk); p(4, 13, robeDk); p(5, 13, robe); p(6, 13, robeDk); p(7, 13, robe); p(8, 13, robeDk);

  } else if (type === 'gatherer') {
    // Ashen hood
    const hood = '#4a4040';
    const hoodHi = '#6a5a54';
    const hoodDk = '#2a2220';
    const cloak = '#3a3028';
    const cloakHi = '#5a4a3a';
    const cloakDk = '#1a1410';
    const scarf = '#884420';

    // Hood top
    p(4, 0, hoodDk); p(5, 0, hood); p(6, 0, hood); p(7, 0, hoodDk);
    p(3, 1, hoodDk); p(4, 1, hood); p(5, 1, hoodHi); p(6, 1, hoodHi); p(7, 1, hood); p(8, 1, hoodDk);
    p(2, 2, hoodDk); p(3, 2, hood); p(4, 2, hoodHi); p(5, 2, hood); p(6, 2, hood); p(7, 2, hoodHi); p(8, 2, hood); p(9, 2, hoodDk);
    // Hood sides framing face
    p(2, 3, hoodDk); p(3, 3, hood); p(4, 3, hoodHi); p(5, 3, hoodDk); p(6, 3, hoodDk); p(7, 3, hoodHi); p(8, 3, hood); p(9, 3, hoodDk);
    // Face in shadow of hood
    p(2, 4, hoodDk); p(3, 4, hood); p(4, 4, skin); p(5, 4, skin); p(6, 4, skin); p(7, 4, skin); p(8, 4, hood); p(9, 4, hoodDk);
    // Eyes
    p(2, 5, hoodDk); p(3, 5, outline); p(4, 5, eyeWhite); p(5, 5, pupil); p(6, 5, skin); p(7, 5, eyeWhite); p(8, 5, pupil); p(9, 5, outline);
    // Nose
    p(3, 6, outline); p(4, 6, skin); p(5, 6, skin); p(6, 6, skinShade); p(7, 6, skin); p(8, 6, skin); p(9, 6, outline);
    // Mouth
    p(3, 7, outline); p(4, 7, skin); p(5, 7, mouth); p(6, 7, mouth); p(7, 7, mouth); p(8, 7, skin); p(9, 7, outline);
    // Chin + scarf
    p(3, 8, outline); p(4, 8, scarf); p(5, 8, scarf); p(6, 8, scarf); p(7, 8, scarf); p(8, 8, scarf); p(9, 8, outline);
    // Scarf / collar
    p(3, 9, cloakDk); p(4, 9, scarf); p(5, 9, scarf); p(6, 9, scarf); p(7, 9, scarf); p(8, 9, scarf); p(9, 9, cloakDk);
    // Cloak body
    p(1, 10, cloakDk); p(2, 10, cloak); p(3, 10, cloakHi); p(4, 10, cloak); p(5, 10, cloak); p(6, 10, cloakDk); p(7, 10, cloak); p(8, 10, cloak); p(9, 10, cloakHi); p(10, 10, cloakDk);
    p(1, 11, cloakDk); p(2, 11, cloak); p(3, 11, cloak); p(4, 11, cloakHi); p(5, 11, cloak); p(6, 11, cloak); p(7, 11, cloakHi); p(8, 11, cloak); p(9, 11, cloak); p(10, 11, cloakDk);
    p(2, 12, cloakDk); p(3, 12, cloakDk); p(4, 12, cloak); p(5, 12, cloakHi); p(6, 12, cloak); p(7, 12, cloakHi); p(8, 12, cloak); p(9, 12, cloakDk);
    p(3, 13, cloakDk); p(4, 13, cloakDk); p(5, 13, cloak); p(6, 13, cloakDk); p(7, 13, cloak); p(8, 13, cloakDk);
  }
}

// ============================================================
// BUILD CARDS
// ============================================================
const container = document.getElementById('card-container');

const cardStates = characters.map((ch, i) => ({
  cooldown: ch.cooldown,
  maxCooldown: ch.maxCooldown,
  logIndex: 0,
  logTimer: 0,
  ready: false,
  readyTimer: 0,
}));

characters.forEach((ch, i) => {
  const card = document.createElement('div');
  card.className = 'char-card obsidian-border';

  const hpPct = (ch.hp / ch.maxHp * 100).toFixed(1);
  const xpPct = (ch.xp / ch.maxXp * 100).toFixed(1);
  const cdPct = (ch.cooldown / ch.maxCooldown * 100).toFixed(1);

  card.innerHTML = `
    <div class="portrait-area">
      <div class="portrait-frame">
        <canvas id="portrait-${i}"></canvas>
      </div>
      <div class="char-name">${ch.name}</div>
      <div class="char-level">Lv. ${ch.level}</div>
    </div>

    <div class="stats-column">
      <div class="log-panel">
        <span class="label">Log</span>
        <span class="log-text" id="log-${i}">${ch.log[0]}</span>
      </div>
      <div class="task-panel">
        <span class="label">Task</span>
        <span class="task-text">${ch.task}</span>
      </div>
      <div class="bars-container">
        <div class="bar-row">
          <span class="bar-label hp">HP</span>
          <div class="bar-outer"><div class="bar-inner hp-bar" style="width:${hpPct}%"></div></div>
          <span class="bar-value">${ch.hp} / ${ch.maxHp}</span>
        </div>
        <div class="bar-row">
          <span class="bar-label xp">XP</span>
          <div class="bar-outer"><div class="bar-inner xp-bar" style="width:${xpPct}%"></div></div>
          <span class="bar-value">${ch.xp.toLocaleString()} / ${ch.maxXp.toLocaleString()}</span>
        </div>
        <div class="bar-row">
          <span class="bar-label cd">CD</span>
          <div class="bar-outer"><div class="bar-inner cd-bar" id="cd-bar-${i}" style="width:${cdPct}%"></div></div>
          <span class="bar-value" id="cd-val-${i}">${ch.cooldown.toFixed(1)}s</span>
        </div>
      </div>
    </div>

    <div class="buttons-column">
      <button class="action-btn">Equip</button>
      <button class="action-btn">Inven</button>
      <button class="action-btn">Skills</button>
      <button class="action-btn">Stats</button>
      <button class="action-btn">Achiev</button>
    </div>
  `;

  container.appendChild(card);

  // Draw portrait
  const canvas = document.getElementById(`portrait-${i}`);
  drawPortrait(canvas, ch.portraitType);
});

// ============================================================
// COOLDOWN TIMER TICK (100ms)
// ============================================================
setInterval(() => {
  characters.forEach((ch, i) => {
    const state = cardStates[i];

    if (state.ready) {
      state.readyTimer -= 0.1;
      if (state.readyTimer <= 0) {
        // Reset cooldown
        state.cooldown = ch.maxCooldown;
        state.ready = false;
      }
      return;
    }

    state.cooldown = Math.max(0, state.cooldown - 0.1);

    const bar = document.getElementById(`cd-bar-${i}`);
    const val = document.getElementById(`cd-val-${i}`);
    const pct = (state.cooldown / ch.maxCooldown * 100).toFixed(1);
    bar.style.width = pct + '%';

    if (state.cooldown <= 0) {
      state.ready = true;
      state.readyTimer = 1.5;
      bar.style.width = '100%';
      bar.classList.add('ready');
      val.textContent = 'READY';
      val.classList.add('ready-text');
    } else {
      bar.classList.remove('ready');
      val.classList.remove('ready-text');
      val.textContent = state.cooldown.toFixed(1) + 's';
    }
  });
}, 100);

// ============================================================
// LOG MESSAGE CYCLING (every 3s)
// ============================================================
setInterval(() => {
  characters.forEach((ch, i) => {
    const state = cardStates[i];
    state.logIndex = (state.logIndex + 1) % ch.log.length;
    const el = document.getElementById(`log-${i}`);
    el.textContent = ch.log[state.logIndex];
  });
}, 3000);

// ============================================================
// EMBER PARTICLES
// ============================================================
(function createEmbers() {
  const container = document.getElementById('ember-container');
  const count = 14;

  for (let i = 0; i < count; i++) {
    const ember = document.createElement('div');
    ember.className = 'ember';

    const size = Math.random() < 0.3 ? 3 : (Math.random() < 0.6 ? 2 : 4);
    const colors = ['#ff6020', '#ff4400', '#ffcc20', '#ff8030', '#cc3300', '#ffaa10', '#ff5010'];
    const color = colors[Math.floor(Math.random() * colors.length)];
    const left = (Math.random() * 100).toFixed(1);
    const duration = 6 + Math.random() * 10;
    const delay = Math.random() * duration;
    const drift = (-30 + Math.random() * 60).toFixed(0) + 'px';

    ember.style.cssText = `
      left: ${left}%;
      width: ${size}px;
      height: ${size}px;
      background: ${color};
      box-shadow: 0 0 ${size + 2}px ${color}60;
      animation-duration: ${duration.toFixed(1)}s;
      animation-delay: -${delay.toFixed(1)}s;
      --drift: ${drift};
    `;

    container.appendChild(ember);
  }
})();
</script>
</body>
</html>
